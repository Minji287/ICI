<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org/DTD Mapper 3.0/EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.festicket.dao.IDao">

	<!-- 행사 관련 -->
	<select id="eventListDao" resultType="com.festicket.dto.EventDto">
		SELECT * FROM event ORDER BY eventNum DESC
	</select>
	
	<select id="totalEventCountDao" resultType="int">
		SELECT COUNT(*) FROM event
	</select>
	
	<!-- 고객센터 게시판 관련 -->
	<select id="csListDao" resultType="com.festicket.dto.CSboardDto">
		SELECT *
		FROM (
		    SELECT A.*, FLOOR(((ROWNUM - 1) / #{param1}) + 1) AS PAGE, ROWNUM AS RN
		    FROM (
		        SELECT *
		        FROM eventCSboard
		        ORDER BY c_idx DESC
		    ) A
		) B
		WHERE PAGE = #{param2}
	</select>
	
	<insert id="csWriteDao">
		INSERT INTO 
			eventCSboard(c_idx, c_userId, c_title, c_content, c_hit, c_replyCount)
				VALUES
					(ecs_seq.nextval, #{param1}, #{param2}, #{param3}, 0, 0)
	</insert>
	
	<select id="csViewDao" resultType="com.festicket.dto.CSboardDto">
		SELECT * FROM eventCSboard WHERE c_idx=#{param1}
	</select>
	
	<update id="csModifyDao">
		UPDATE eventCSboard SET c_title=#{param2}, c_content=#{param3} WHERE c_idx=#{param1}
	</update>
	
	<delete id="csDeleteDao">
		DELETE FROM eventCSboard WHERE c_idx=#{param1}
	</delete>
	
	<update id="csHitDao">
		UPDATE eventCSboard SET c_hit=c_hit+1 WHERE c_idx=#{param1}
	</update>
	
	<select id="csListTotalCountDao" resultType="int">
		SELECT COUNT(*) FROM eventCSboard
	</select>
	
	
	<!-- 고객센터 검색 관련 -->
	<select id="csSearchTitleDao" resultType="com.festicket.dto.CSboardDto">
	    SELECT * FROM eventCSboard WHERE c_title LIKE '%' || #{param1} || '%' ORDER BY c_idx DESC
	</select>
	
	<select id="csSearchContentDao" resultType="com.festicket.dto.CSboardDto">
	    SELECT * FROM eventCSboard WHERE c_content LIKE '%' || #{param1} || '%' ORDER BY c_idx DESC
	</select>
	
	<select id="csSearchWriterDao" resultType="com.festicket.dto.CSboardDto">
	    SELECT * FROM eventCSboard WHERE c_userID LIKE '%' || #{param1} || '%' ORDER BY c_idx DESC
	</select>
	
	
	<!-- 댓글 관련 -->
	<insert id="replyWriteDao">
		INSERT INTO 
			eventCSanswer(ca_idx, ca_userId, ca_content, ca_boardNum)
				VALUES
					(ecsa_seq.nextval, '관리자', #{param1}, #{param2})
	</insert>
	
	<update id="replyCountDao">
		UPDATE eventCSboard SET c_replyCount=c_replyCount+1 WHERE c_idx=#{param1}
	</update>
	
	<select id="replyListDao" resultType="com.festicket.dto.CSanswerDto">
		SELECT * FROM eventCSanswer WHERE ca_boardNum=#{param1} ORDER BY ca_idx ASC
	</select>
	
	<delete id="replyDeleteDao">
		DELETE FROM eventCSanswer WHERE ca_idx=#{param1}
	</delete>
	
	<update id="replyCountMinusDao">
		UPDATE eventCSboard SET c_replyCount=c_replyCount-1 WHERE c_idx=#{param1}
	</update>
	
	<delete id="boardReplyDeleteDao">
		DELETE FROM eventCSanswer WHERE ca_boardNum=#{param1}
	</delete>
	
</mapper>